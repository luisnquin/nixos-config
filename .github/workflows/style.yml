name: Style check

on: [push, pull_request, workflow_dispatch]

jobs:
    check:
        name: It comes out with exit code 1 in case Alejandra sent suggestions in the nix code
        runs-on: ubuntu-latest

        steps:
            - uses: actions/checkout@v3

            - uses: cachix/install-nix-action@v18
              with:
                  install_url: https://nixos.org/nix/install
                  extra_nix_config: |
                      auto-optimise-store = true
                      experimental-features = nix-command flakes
                  # nix_path: nixpkgs=channel:nixos-unstable

            - name: Alejandra installation
              run: nix-env -f '<nixpkgs>' -iA alejandra

            - name: Code checking
              run: "! alejandra -c . 2>&1 | grep 'Would be changed'"
