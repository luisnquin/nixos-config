name: Style check

on:
    push:
        branches:
            - main

jobs:
    check:
        name: It comes out with exit code 1 in case Alejandra sent suggestions in the nix code
        runs-on: ubuntu-latest

        steps:
            - uses: actions/checkout@v2

            - name: Cargo.toml file creation
              run: echo -e '[package]\nname = "any"\nversion = "0.1.0"\nedition = "2022"\n\n[dependencies]' > Cargo.toml

            - uses: actions-rs/toolchain@v1
              with:
                  toolchain: stable

            - uses: actions-rs/cargo@v1
              with:
                  command: build
                  args: --release --all-features

            - name: Alejandra installation
              run: cargo install alejandra

            - name: Code checking
              run: "! alejandra -c . 2>&1 | grep 'Would be changed'"
